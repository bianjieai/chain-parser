package integration

import (
	"encoding/hex"
	"fmt"
	. "github.com/kaifei-bianjie/common-parser/codec"
	"github.com/kaifei-bianjie/common-parser/utils"
)

func (s IntegrationTestSuite) TestToken() {
	cases := []SubTest{
		{
			"MintToken",
			MintToken,
		},
		{
			"BurnToken",
			BurnToken,
		},
		{
			"EditToken",
			EditToken,
		},
		{
			"IssueToken",
			IssueToken,
		},
		{
			"TransferTokenOwner",
			TransferTokenOwner,
		},
	}

	for _, t := range cases {
		s.Run(t.testName, func() {
			t.testCase(s)
		})
	}
}

func MintToken(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)
	txBytes, err := hex.DecodeString("0A85010A82010A1B2F697269736D6F642E746F6B656E2E4D73674D696E74546F6B656E12630A036573741080C8AFA0251A2A69616131646E6E786A636E6B63377672356B70356E3365796A7235703564393978636E783665786E3370222A69616131646E6E786A636E6B63377672356B70356E3365796A7235703564393978636E783665786E3370126A0A510A460A1F2F636F736D6F732E63727970746F2E736563703235366B312E5075624B657912230A210251CA6230319F0F129D2DE9CA5739DE9DCB4C685485B32AE742A8BBAA55E2CFD712040A02080118B27412150A0F0A057569726973120635303030303010E0A7121A40585A2ACF5357E8F71AAEA714B9F545A9272357F287B66CA40D324F60383D2C5256F5EE93808FCB7955C06CDC64017168944E6676047533AF48B0056ACBB1779C")
	if err != nil {
		fmt.Println(err.Error())
	}
	authTx, err := GetSigningTx(txBytes)
	if err != nil {
		fmt.Println(err.Error())
	}
	for _, msg := range authTx.GetMsgs() {
		if bankDoc, ok := s.Token.HandleTxMsg(msg); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(bankDoc))
		}
	}
}

func BurnToken(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)
	txBytes, err := hex.DecodeString("0A560A540A1B2F697269736D6F642E746F6B656E2E4D73674275726E546F6B656E12350A05686170707910641A2A696161316878797874796779386476643674337672367A6D6B30617072347032756C756E76363036726E12690A500A460A1F2F636F736D6F732E63727970746F2E736563703235366B312E5075624B657912230A2103F5330F7602F5AA3994F462C71380E2FC0288FAA228890987B2F069DD9DCC7BBB12040A020801181C12150A0F0A057569726973120631303030303010C09A0C1A40D3FD6FD232532954F507949571425C6C5EA428E40D3811692F1F7D9116C3BCFB2071B0FE06BB095A159045347252A130AFCB2E182361C23880E9FA63376D9CC8")
	if err != nil {
		fmt.Println(err.Error())
	}
	authTx, err := GetSigningTx(txBytes)
	if err != nil {
		fmt.Println(err.Error())
	}
	for _, msg := range authTx.GetMsgs() {
		if bankDoc, ok := s.Token.HandleTxMsg(msg); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(bankDoc))
		}
	}
}

func EditToken(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)
	txBytes, err := hex.DecodeString("0A6C0A6A0A1B2F697269736D6F642E746F6B656E2E4D736745646974546F6B656E124B0A056861707079120B686170707920546F6B656E188095F52A2204747275652A2A696161316878797874796779386476643674337672367A6D6B30617072347032756C756E76363036726E12690A500A460A1F2F636F736D6F732E63727970746F2E736563703235366B312E5075624B657912230A2103F5330F7602F5AA3994F462C71380E2FC0288FAA228890987B2F069DD9DCC7BBB12040A020801181812150A0F0A057569726973120635303030303010C09A0C1A40E2F7FD62CF5A465520085714ACB3A16054A1E57975174D8D02949C0C6F5E5CAD0A9292182AA792DF0BE3C5AF36711499DC938027AC6E1D55075E9B579505DEFC")
	if err != nil {
		fmt.Println(err.Error())
	}
	authTx, err := GetSigningTx(txBytes)
	if err != nil {
		fmt.Println(err.Error())
	}
	for _, msg := range authTx.GetMsgs() {
		if bankDoc, ok := s.Token.HandleTxMsg(msg); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(bankDoc))
		}
	}
}

func IssueToken(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)
	txBytes, err := hex.DecodeString("0A7E0A7C0A1C2F697269736D6F642E746F6B656E2E4D73674973737565546F6B656E125C0A0B7777746F6B656E30383132120B7777746F6B656E6E616D651805220C757777746F6B656E30383132286430643801422A696161316E36797835376B3372703270666B3872656B616B666168793734306E7936307339346333633912650A510A460A1F2F636F736D6F732E63727970746F2E736563703235366B312E5075624B657912230A21031E1C20E53BA1CB3EE6C25BDFBAD01AA784B2F1ACEB77A589BF241B104685507912040A02080118E80112100A0A0A05756972697312013210C09A0C1A40F30C5F24F6FC31195A75F191FAC77DA38661475AA3A78E7A24D397829C64739A0F72BB6A655C5BFBC80BEB47B98BFCDA307C37DC2ED05DB29E363E835760CE29")
	if err != nil {
		fmt.Println(err.Error())
	}
	authTx, err := GetSigningTx(txBytes)
	if err != nil {
		fmt.Println(err.Error())
	}
	for _, msg := range authTx.GetMsgs() {
		if bankDoc, ok := s.Token.HandleTxMsg(msg); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(bankDoc))
		}
	}
}

func TransferTokenOwner(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)
	txBytes, err := hex.DecodeString("0A8A010A87010A242F697269736D6F642E746F6B656E2E4D73675472616E73666572546F6B656E4F776E6572125F0A2A696161316878797874796779386476643674337672367A6D6B30617072347032756C756E76363036726E122A696161317A616565767173326C756A7265306B796C367563667072366C7868716370736D7632733566741A05686170707912690A500A460A1F2F636F736D6F732E63727970746F2E736563703235366B312E5075624B657912230A2103F5330F7602F5AA3994F462C71380E2FC0288FAA228890987B2F069DD9DCC7BBB12040A020801181B12150A0F0A057569726973120635303030303010C09A0C1A40E724A2D10999C1DB3E9107FA363C2929916A98E79F72DBFBF51C90D5BF55F2F631BBC0C3CB34D66E820853E50CDB6F6F2AB986B53E827D95E13C243EDB61DF65")
	if err != nil {
		fmt.Println(err.Error())
	}
	authTx, err := GetSigningTx(txBytes)
	if err != nil {
		fmt.Println(err.Error())
	}
	for _, msg := range authTx.GetMsgs() {
		if bankDoc, ok := s.Token.HandleTxMsg(msg); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(bankDoc))
		}
	}
}
