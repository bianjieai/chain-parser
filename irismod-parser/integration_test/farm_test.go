package integration

import (
	"encoding/hex"
	"fmt"
	. "github.com/bianjieai/chain-parser/common-parser/codec"
	"github.com/bianjieai/chain-parser/common-parser/utils"
)

func (s IntegrationTestSuite) TestFarm() {
	cases := []SubTest{
		{
			"unstake",
			unstake,
		},
		{
			"stake",
			stake,
		},
		{
			"createPool",
			createPool,
		},
		{
			"createPoolWithCommunityPool",
			createPoolWithCommunityPool,
		},
		{
			"destroyPool",
			destroyPool,
		},
		{
			"adjustPool",
			adjustPool,
		},
		{
			"harvest",
			harvest,
		},
	}

	for _, t := range cases {
		s.Run(t.testName, func() {
			t.testCase(s)
		})
	}
}

func unstake(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)
	txBytes, err := hex.DecodeString("0A5F0A5D0A182F697269736D6F642E6661726D2E4D7367556E7374616B6512410A076661726D2D3135120A0A056C70742D311201311A2A696161316571766B667468747272393367347039717370703534773664746A74726E323761723772707712690A510A460A1F2F636F736D6F732E63727970746F2E736563703235366B312E5075624B657912230A21038BE4539785F0621A19066EB2DA45C11DCC5FCCFF5D58E89C670BB80D251CC1B712040A02080118D21012140A0D0A0575697269731204323030301080DAC4091A404625ECA528EF9ABC81C95042A4F69D9E7653229B29B43EDF8835B08A9B3B8DA4409A79A73C68D6F9688DB5E76BC5D3513F203548AE8C7BB2E532D0B72DC87868")
	if err != nil {
		fmt.Println(err.Error())
	}
	authTx, err := GetSigningTx(txBytes)
	if err != nil {
		fmt.Println(err.Error())
	}
	for _, irismod := range authTx.GetMsgs() {
		if bankDoc, ok := s.Farm.HandleTxMsg(irismod); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(bankDoc))
		}
	}
}

func stake(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)
	txBytes, err := hex.DecodeString("0A670A620A162F697269736D6F642E6661726D2E4D73675374616B6512480A076661726D2D363812110A066C70742D32311207313132333435361A2A696161316571766B667468747272393367347039717370703534773664746A74726E3237617237727077120120126A0A510A460A1F2F636F736D6F732E63727970746F2E736563703235366B312E5075624B657912230A21038BE4539785F0621A19066EB2DA45C11DCC5FCCFF5D58E89C670BB80D251CC1B712040A02080118991112150A0F0A05756972697312063430303030301080B5181A409CC163E577F77F5BBDE170B17404987E639274FBA401B460F991422FEABBD7011939EC64D346C1F41D83DCF3E734AEEB82F8289B74F9E763B0EEEEEB10156F02")
	if err != nil {
		fmt.Println(err.Error())
	}
	authTx, err := GetSigningTx(txBytes)
	if err != nil {
		fmt.Println(err.Error())
	}
	for _, irismod := range authTx.GetMsgs() {
		if bankDoc, ok := s.Farm.HandleTxMsg(irismod); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(bankDoc))
		}
	}
}

func createPool(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)
	txBytes, err := hex.DecodeString("0A8D010A8A010A1B2F697269736D6F642E6661726D2E4D7367437265617465506F6F6C126B0A0A6661726D20206465736312066C70742D323118AE8FEC01220E0A057569726973120532323030302A140A057569726973120B31303030303030303030303A2A6961613137636A64673633746879327666717676676A356C667635647033333974306C72613267713875126B0A510A460A1F2F636F736D6F732E63727970746F2E736563703235366B312E5075624B657912230A2102A53EA4DC106AE521C8354FD35F57149A9EEC9530332D2D6C53C80BB3F323A7D412040A02080118DB2212160A100A05756972697312073130303030303010C09A0C1A407E0AFF83460DFF3B8C2B7C836FC5CC22A360B7FAE9E84D940BB8211252628C9B3BCFD18537101102D108054417C13A25AF66B98EF7AE5CBC76AC78F08ACB88E3")
	if err != nil {
		fmt.Println(err.Error())
	}
	authTx, err := GetSigningTx(txBytes)
	if err != nil {
		fmt.Println(err.Error())
	}
	for _, irismod := range authTx.GetMsgs() {
		if bankDoc, ok := s.Farm.HandleTxMsg(irismod); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(bankDoc))
		}
	}
}

func createPoolWithCommunityPool(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)
	txBytes, err := hex.DecodeString("0AD4020AC2020A2C2F697269736D6F642E6661726D2E4D7367437265617465506F6F6C57697468436F6D6D756E697479506F6F6C1291020A8B010A32737A6370726F73646673646673646673646673646673646673646673646673646673646673647765616C2D7469746C657072121EE2809C70726F706F73616C2D6465736372697074696F70726F6163E2809D1A166465736372697074696F6E6465736372697074696F6E22056C70742D322A0A0A057569726973120131320A0A05756972697312013112550A446962632F31373135383631433934373832463342383338373038433239323539353643463544343144364239373838324633323930454338383046434645393046373137120D313233343536373839353535321A2A696161316571766B667468747272393367347039717370703534773664746A74726E3237617237727077120D6E6F74656E6F74656E6F74656E12670A510A460A1F2F636F736D6F732E63727970746F2E736563703235366B312E5075624B657912230A21038BE4539785F0621A19066EB2DA45C11DCC5FCCFF5D58E89C670BB80D251CC1B712040A02080118B30112120A0C0A057569726973120331303010C09A0C1A400A2B8262197589C1888AD8225B05B233DB5C7F1E892176EBA36EC11969746E796091F2368FC3DBCB94722FA041A836E4937DAEA4A5B379AD290F2B5CA87E48FD")
	if err != nil {
		fmt.Println(err.Error())
	}
	authTx, err := GetSigningTx(txBytes)
	if err != nil {
		fmt.Println(err.Error())
	}
	for _, irismod := range authTx.GetMsgs() {
		if bankDoc, ok := s.Farm.HandleTxMsg(irismod); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(bankDoc))
		}
	}
}

func destroyPool(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)
	txBytes, err := hex.DecodeString("0A570A550A1C2F697269736D6F642E6661726D2E4D736744657374726F79506F6F6C12350A076661726D2D3434122A696161316571766B667468747272393367347039717370703534773664746A74726E3237617237727077126B0A510A460A1F2F636F736D6F732E63727970746F2E736563703235366B312E5075624B657912230A21038BE4539785F0621A19066EB2DA45C11DCC5FCCFF5D58E89C670BB80D251CC1B712040A02080118EA0112160A100A05756972697312073130303030303010C09A0C1A40C01E4CB8540F92CF91CBEA7E827E68416C48B516F56C0B8D7383DA77AFC0F920496F0CA57A961F6904B745258AE0A08BD2A39C97E58ED380D7F0E23CBAB9D637")
	if err != nil {
		fmt.Println(err.Error())
	}
	authTx, err := GetSigningTx(txBytes)
	if err != nil {
		fmt.Println(err.Error())
	}
	for _, irismod := range authTx.GetMsgs() {
		if bankDoc, ok := s.Farm.HandleTxMsg(irismod); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(bankDoc))
		}
	}
}

func adjustPool(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)
	txBytes, err := hex.DecodeString("0A620A600A1B2F697269736D6F642E6661726D2E4D736741646A757374506F6F6C12410A076661726D2D33331A0A0A057569726973120132222A696161316571766B667468747272393367347039717370703534773664746A74726E323761723772707712590A510A460A1F2F636F736D6F732E63727970746F2E736563703235366B312E5075624B657912230A21038BE4539785F0621A19066EB2DA45C11DCC5FCCFF5D58E89C670BB80D251CC1B712040A020801188E01120410C09A0C1A40BB6DB7CF5423F6CD59F85754B499D814D83F59B32D755F5F36D58FE06E2C9EC7329DD1E5FD86506AB61DEC8A54177033DA475539058DD26D8EA367D4C4F1D425")
	if err != nil {
		fmt.Println(err.Error())
	}
	authTx, err := GetSigningTx(txBytes)
	if err != nil {
		fmt.Println(err.Error())
	}
	for _, irismod := range authTx.GetMsgs() {
		if bankDoc, ok := s.Farm.HandleTxMsg(irismod); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(bankDoc))
		}
	}
}

func harvest(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)
	txBytes, err := hex.DecodeString("0A560A510A182F697269736D6F642E6661726D2E4D73674861727665737412350A076661726D2D3638122A696161316571766B667468747272393367347039717370703534773664746A74726E3237617237727077120120126A0A510A460A1F2F636F736D6F732E63727970746F2E736563703235366B312E5075624B657912230A21038BE4539785F0621A19066EB2DA45C11DCC5FCCFF5D58E89C670BB80D251CC1B712040A02080118981112150A0F0A05756972697312063430303030301080B5181A4030292A9A67518A2B189EE1E86D486E7F1019097BF4319E54997D65B2781A353A2BCDC4BA4EE14E5389E0B63C9CB4F152D464741DE3C17971DA71B2BBC8773CD0")
	if err != nil {
		fmt.Println(err.Error())
	}
	authTx, err := GetSigningTx(txBytes)
	if err != nil {
		fmt.Println(err.Error())
	}
	for _, irismod := range authTx.GetMsgs() {
		if bankDoc, ok := s.Farm.HandleTxMsg(irismod); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(bankDoc))
		}
	}
}
